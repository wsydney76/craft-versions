{% extends "_layouts/cp" %}
{% set title = 'Drafts'|t('versions') %}

{% set status = craft.app.request.param('status') ?: 'all' %}
{% set site = craft.app.request.param('site') ?: '*' %}
{% set preferSite = craft.app.request.param('site') ?: craft.app.sites.primarySite.handle %}

{% block sidebar %}
    <nav>
        <ul>
            <li class="heading"><span>{{ "By status"|t('versions') }}</span></li>
            <li>
                <a class="{{ status == 'all' ?'sel' }}" href="{{ cpUrl('versions/drafts',{status:'all'}) }}">
                    <span class="label">{{ "All"|t('versions') }}</span></a>
            </li>
            <li>
                <a class="{{ status == 'unsaved' ?'sel' }}" href="{{ cpUrl('versions/drafts',{status:'unsaved'}) }}">
                    <span class="label">{{ "Unsaved"|t('versions') }}</span></a>
            </li>
            <li>
                <a class="{{ status == 'saved' ?'sel' }}" href="{{ cpUrl('versions/drafts',{status:'saved'}) }}">
                    <span class="label">{{ "Saved"|t('versions') }}</span></a>
            </li>

            {% set allSites = craft.app.sites.allSites %}
            {% if allSites|length > 1 %}
                <li class="heading"><span>{{ "By sites"|t('versions') }}</span></li>
                {% for curSite in allSites %}
                    <li>
                        <a class="{{ site == curSite.handle ?'sel' }}"
                           href="{{ cpUrl('versions/drafts',{site:curSite.handle}) }}">
                            <span class="label">{{ curSite.name }}</span></a>
                    </li>
                {% endfor %}
            {% endif %}
        </ul>
    </nav>
{% endblock %}


{% block content %}

    {% set entries = craft.entries.site(site).unique().preferSites([preferSite]).anyStatus().drafts(true).orderBy('dateCreated desc').all() %}

    {% if entries %}
        <table id="entries" class="data fullwidth collapsible">
            <thead>
            <tr>
                <th scope="col">{{ "Title"|t('versions') }}</th>
                <th scope="col">{{ "Section"|t('versions') }}</th>
                <th scope="col">{{ "ID"|t('versions') }}</th>
                <th scope="col">{{ "Date created"|t('versions') }}</th>
                <th scope="col">{{ "Date updated"|t('versions') }}</th>
                <th scope="col">{{ "Internal"|t('versions') }}</th>

            </tr>
            </thead>

            <tbody>

            {% for entry in entries
                if status == 'all'
                or (status == 'unsaved' and entry.isUnsavedDraft == true)
                or (status == 'saved' and entry.isUnsavedDraft == false) %}

                {% set section = entry.section.handle %}
                {% set site = entry.site.handle %}

                <tr data-id="{{ entry.id }}" data-name="{{ entry.title }}">

                    <th data-title="Title">
                        <a class="go"
                           href="{{ cpUrl("entries/#{section}/#{entry.sourceId}", {site:site,draftId:entry.draftId,fresh:entry.isUnsavedDraft}) }}">{{ entry.title }}</a>
                    </th>

                    <td data-title="section">
                        {{ entry.section.name }}
                    </td>

                    <td data-title="Saved">
                        {{ entry.isUnsavedDraft ? 'Unsaved'|t('versions') : 'Saved'|t('versions') }}
                    </td>

                    <td data-title="dateCreated">
                        {{ entry.dateCreated|datetime('Y-m-d G:i') }}
                    </td>
                    <td data-title="dateUpdated">
                        {{ entry.dateUpdated|datetime('Y-m-d G:i') }}
                    </td>
                    <td data-title="internal">
                        ID: {{ entry.id }}
                        Draft ID: {{ entry.draftId }}
                        Source ID: {{ entry.sourceId }}
                    </td>


                </tr>
            {% endfor %}

            </tbody>
        </table>
    {% endif %}

{% endblock %}
